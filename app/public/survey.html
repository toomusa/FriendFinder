<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">

  <link rel="stylesheet" type="text/css" href="./../../assets/css/reset.css">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
  <link rel="stylesheet" href="./../../assets/css/style.css">

  <title>Friend Finder</title>
</head>
<body>

  <div class="container">
  
    <div class="row">
      <div class="col-sm-12 col-xs-12 col-md-12" id="heading">
        <!-- header row -->
        <h1>Friend Finder</h1>
      </div>
    </div>
  
    <div class="row">
      <div class="col-sm-10 col-xs-12 col-md-10 offset-sm-1 offset-xs-0 offset-md-1" id="main">
        <!-- main content area -->
        <form>
            <h3>Survey Questions</h3>
            <div class="questionTitle" style="font-weight: bold">Name (required)</div>
            <input type="text" id="name" style="width: 100%">
            <div class="questionTitle" style="font-weight: bold">Link to Profile Image (required)</div>
            <input type="text" id="photo" style="width: 100%">
            <hr>
            <span class="questionTitle">Q1:</span>
            <span id="Q1" style="font-weight: bold"></span>
            <select class="response float-right" id="A1" name="A1"></select>
            <hr>
            <span class="questionTitle">Q2:</span>
            <span id="Q2" style="font-weight: bold"></span>
            <select class="response float-right" id="A2" name="A2"></select>
            <hr>
            <span class="questionTitle">Q3:</span>
            <span id="Q3" style="font-weight: bold"></span>
            <select class="response float-right" id="A3" name="A3"></select>
            <hr>
            <span class="questionTitle">Q4:</span>
            <span id="Q4" style="font-weight: bold"></span>
            <select class="response float-right" id="A4" name="A4"></select>
            <hr>
            <span class="questionTitle">Q5:</span>
            <span id="Q5" style="font-weight: bold"></span>
            <select class="response float-right" id="A5" name="A5"></select>
            <hr>
            <span class="questionTitle">Q6:</span>
            <span id="Q6" style="font-weight: bold"></span>
            <select class="response float-right" id="A6" name="A6"></select>
            <hr>
            <span class="questionTitle">Q7:</span>
            <span id="Q7" style="font-weight: bold"></span>
            <select class="response float-right" id="A7" name="A7"></select>
            <hr>
            <span class="questionTitle">Q8:</span>
            <span id="Q8" style="font-weight: bold"></span>
            <select class="response float-right" id="A8" name="A8"></select>
            <hr>
            <span class="questionTitle">Q9:</span>
            <span id="Q9" style="font-weight: bold"></span>
            <select class="response float-right" id="A9" name="A9"></select>
            <hr>
            <span class="questionTitle">Q10:</span>
            <span id="Q10" style="font-weight: bold"></span>
            <select class="response float-right" id="A10" name="A10"></select>
            <hr>
            <div style="text-align: center">
                <button class="btn btn-lg btn-primary" type="submit" id="submit">Submit Answers</button>            
            </div>
        </form>
      </div>
    </div>

    <div class="row">
      <div class="col-sm-12 col-xs-12 col-md-12" id="footing">
        <!-- footer row -->
        <a href="/api/friends">API List</a>
      </div>
    </div>
    
  </div>

   <!-- Modal -->
<div id="results-modal" class="modal fade" role="dialog">
    <div class="modal-dialog">
        <!-- Modal content -->
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title"><strong>Your Best Match</strong></h2>
                <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="container">
                    <div class="row">
                        <!-- <div class="ml-auto">
                            <div class="card" style="width: 18rem;">
                                <img id="user-img" src="" class="card-img-top" alt="Your Photo">
                                <div class="card-body">
                                    <h3 class="card-text" id="user-name"></h3>
                                </div>
                            </div>
                        </div> -->
                        <div class="col-xs-12 col-sm-12 col-md-12" id="modality">
                            <div class="card" style="width: 80%;">
                                <img id="match-img" src="" class="card-img-top" alt="Your Photo">
                                <div class="card-body">
                                    <h3 class="card-text" id="match-name"></h3>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>
        </div>

    </div>
</div>



  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
  <link rel="text/javascript" href="../data/friends.js"/>


  <script type="text/javascript">

    const profiles = [
        {
            name: "Kelly",
            photo: "http://lorempixel.com/200/200",
            scores: [7, 6, 2, 8, 9, 4, 3, 4, 5, 8]
        },
        {
            name: "Melly",
            photo: "http://lorempixel.com/200/200",
            scores: [4, 3, 8, 9, 5, 3, 1, 7, 5, 4]
        },
        {
            name: "Nelly",
            photo: "http://lorempixel.com/200/200",
            scores: [9, 6, 1, 3, 8, 7, 5, 4, 9, 6]
        },
        {
            name: "Jelly",
            photo: "http://lorempixel.com/200/200",
            scores: [2, 7, 6, 4, 8, 3, 6, 7, 9, 2]
        },
        {
            name: "Shelley",
            photo: "http://lorempixel.com/200/200",
            scores: [8, 7, 6, 3, 1, 6, 4, 9, 2, 7]
        },
        {
            name: "Relly",
            photo: "http://lorempixel.com/200/200",
            scores: [6, 3, 9, 8, 5, 7, 2, 4, 6, 7]
        },
        {
            name: "Telly",
            photo: "http://lorempixel.com/200/200",
            scores: [2, 9, 3, 5, 6, 4, 8, 7, 2, 1]
        },
        {
            name: "Belly",
            photo: "http://lorempixel.com/200/200",
            scores: [5, 9, 9, 7, 2, 1, 5, 3, 1, 3]
        },
        {
            name: "Zelly",
            photo: "http://lorempixel.com/200/200",
            scores: [8, 2, 1, 6, 3, 9, 4, 6, 7, 5]
        },
        {
            name: "Lelly",
            photo: "http://lorempixel.com/200/200",
            scores: [8, 9, 6, 7, 2, 4, 9, 3, 8, 7]
        }
    ]
    
    const questions = [
        "Political correctness is a detriment to freedom of speech.",
        "Trigger words are the scapegoat of the mentally feeble.",
        "Extremesim is the root of all the world's problems.",
        "Sustainable practices at an individual level will not save the world.",
        "Lobbying is legalized bribery.",
        "Intolerance of intolerance is a virtue.",
        "Passion without purpose is obsession.",
        "Being offended is a personal choice.",
        "Every vote should count, but not weigh the same.",
        "All is unfair in love and war."
    ]

    // Populate survey page with questions
    questions.forEach(e => {
        (document).getElementById(`Q${questions.indexOf(e) + 1}`).textContent = e;
    });

    // Populate select box with options
    let opt0 = $(`<option value=""></option>`)
    let opt1 = $(`<option value="1">1 (Disagree)</option>`)
    let opt2 = $(`<option value="2">2</option>`)
    let opt3 = $(`<option value="3">3</option>`)
    let opt4 = $(`<option value="4">4</option>`)
    let opt5 = $(`<option value="5">5</option>`)
    let opt6 = $(`<option value="6">6</option>`)
    let opt7 = $(`<option value="7">7</option>`)
    let opt8 = $(`<option value="8">8</option>`)
    let opt9 = $(`<option value="9">9</option>`)
    let opt10 = $(`<option value="10">10 (Agree)</option>`)
    $(".response").append(opt0, opt1, opt2, opt3, opt4, opt5, opt6, opt7, opt8, opt9, opt10)

    const compareScores = (newUser) => {
        return new Promise ((resolve, reject) => {
            if (!newUser) reject();
            let userOptions = [];
            profiles.forEach(user => {
                let scoreComparison = 0;
                for (let i = 0; i < user.scores.length; i++) {
                    scoreComparison += Math.abs(user.scores[i] - newUser.scores[i]);
                }
                userOptions.push(scoreComparison);
            })
            let closestMatch = Math.min(...userOptions);
            let matchingProfile = userOptions.indexOf(closestMatch);
            resolve(profiles[matchingProfile]);
        })
    }

    $("#submit").on("click", async (event) => {
        event.preventDefault();

        let newUser = {
            name: $("#name").val(),
            photo: $("#photo").val(),
            scores: [$("#A1").val(), $("#A2").val(), $("#A3").val(), $("#A4").val(), $("#A5").val(), 
                    $("#A6").val(), $("#A7").val(), $("#A8").val(), $("#A9").val(), $("#A10").val()]
        }

        let bestMatch = await compareScores(newUser);

        console.log(bestMatch)

        // $.post("/api/friends", newUser, function(bestMatch) {
            $("#user-name").text(newUser.name);
            $("#user-img").attr("src", newUser.photo);
            $("#match-name").text(bestMatch.name);
            $("#match-img").attr("src", bestMatch.photo);
            $("#results-modal").modal("toggle");
        // });
    })
    

  </script>
</body>
  <!-- <script src="../data/friends.js"></script> -->
</html>